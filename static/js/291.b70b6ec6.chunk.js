"use strict";(self.webpackChunkmy_react_appo=self.webpackChunkmy_react_appo||[]).push([[291],{1291:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var n=a(9950),o=a(6491),l=a(5333),r=a(226),i=a(5277),c=a(2053),s=a(899),u=a(6630),d=a(9890),g=a(6639),h=a(7901),m=a(2578),x=a(1975),p=a(2241),y=a(9751),v=a(2845),f=a(4414);const j=e=>{let{file:t,onRemove:a,index:r}=e;const[i,c]=(0,n.useState)("");return(0,n.useEffect)((()=>{if(t){const e=URL.createObjectURL(t);return c(e),()=>{URL.revokeObjectURL(e)}}}),[t]),(0,f.jsx)(o.A,{sx:{position:"relative",display:"inline-block"},children:t?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("img",{src:i,alt:"Preview",style:{maxWidth:"100px",maxHeight:"100px"}}),(0,f.jsx)(l.A,{color:"error",size:"small",onClick:()=>a(t),sx:{position:"absolute",top:0,right:0},children:"\xd7"})]}):(0,f.jsx)(o.A,{sx:{width:"100px",height:"100px",border:"1px dashed gray",display:"flex",alignItems:"center",justifyContent:"center",color:"gray"},children:r+1})})},A=()=>{const[e,t]=(0,n.useState)(""),[a,A]=(0,n.useState)(""),[b,C]=(0,n.useState)(""),[w,E]=(0,n.useState)(""),[S,k]=(0,n.useState)(""),[P,R]=(0,n.useState)(""),[I,D]=(0,n.useState)(!1),[K,G]=(0,n.useState)(""),[U,N]=(0,n.useState)([]),[F,L]=(0,n.useState)("Aerea"),[V,q]=(0,n.useState)(null),[W,z]=(0,n.useState)(null),[T,B]=(0,n.useState)([]),[O,Z]=(0,n.useState)(!0),[X,_]=(0,n.useState)([]),[J,M]=(0,n.useState)([]),[Q,Y]=(0,n.useState)([]),[H,$]=(0,n.useState)([]),[ee,te]=(0,n.useState)({}),[ae,ne]=(0,n.useState)(""),[oe,le]=(0,n.useState)(""),[re,ie]=(0,n.useState)(""),ce=(0,m.C3)(p.A),se=(0,y.c7)(p.A),ue=async e=>{const t=(0,y.KR)(se,"Imagenes/Nuevo/".concat(Date.now(),".jpeg"));return await(0,y.D)(t,e),await(0,y.qk)(t)},de=async e=>new Promise(((t,a)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>{const e=new Image;e.src=n.result,e.onload=()=>{const a=document.createElement("canvas"),n=1200;let o=e.width,l=e.height;o>l?o>n&&(l*=n/o,o=n):l>900&&(o*=900/l,l=900),a.width=o,a.height=l;a.getContext("2d").drawImage(e,0,0,o,l);const r=a.toDataURL("image/jpeg",.9);t(ge(r))},e.onerror=e=>a(e)},n.onerror=e=>a(e)})),ge=e=>{const t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),o=new Uint8Array(n);for(let l=0;l<t.length;l++)o[l]=t.charCodeAt(l);return new Blob([n],{type:a})},he=e=>{Z(!1),ie(e),console.log("Selected view: ".concat(e))};(0,n.useEffect)((()=>{if(""!==re){((e,t)=>{const a=(0,m.KR)(ce,"GE/Categorias/".concat(re));(0,m.Jt)(a).then((e=>{const t=[];e.forEach((e=>{const a=e.val();a&&!(0,x.D0)(a.Codigo,J)&&(console.log(a.Estado,"an"),t.push(a))})),console.log(t,"wettin"),M(t)})).catch((e=>{console.error("Error fetching data:",e)}))})()}return()=>{}}),[re]);const me=e=>{console.log(e,"es");const t=(0,m.KR)(ce,"GE/Secciones/".concat(e));(0,m.Jt)(t).then((e=>{const t=[];e.forEach((e=>{const a=e.val();t.push(a)})),console.log(t,"wettin"),Y(t)})).catch((e=>{console.error("Error fetching data:",e)}))};return(0,f.jsxs)(o.A,{children:[(0,f.jsx)(v.A,{texto:"Publicar Prod"}),O&&(0,f.jsxs)(o.A,{sx:{display:"flex",gap:5,m:10},children:[(0,f.jsx)(r.A,{variant:"contained",onClick:()=>he("Nacional"),children:"Nacional"}),(0,f.jsx)(r.A,{variant:"contained",onClick:()=>he("Exterior"),children:"Exterior"})]}),""!==re&&(0,f.jsxs)(o.A,{component:"form",onSubmit:async n=>{if(null!==V&&null!==W){n.preventDefault(),D(!0);let l=Date.now();try{const n=await ue(U[0]),o=(0,m.VC)((0,m.KR)(ce,"GE/".concat(re,"/Prod"))).key;let r,i="Exterior"===re?"C0y1aQsV5NZNLBuvprio3vXy2LR2":"kbJogy4k8gN7nSK2QUFXwMpXSXz1";if("Exterior"===re){let t=""!==w?1e-6*w:"";r={Titulo:e,Condicion:"Nuevo",Categoria:V,Subcategoria:W,Codigo:o,Precio:parseInt(a),Envio:F,Stock:!0,Descuento:0,Peso:""!==b?parseFloat(b):0,Dimension:parseFloat(t.toFixed(4)),Ubicacion:P,Pais:"China",Detalles:K,Imagen:n,Vistos:0,Duracion:"20-35 dias",Vendedor:i,Compras:0,Fecha:l}}else r={Titulo:e,Condicion:"Nuevo",Categoria:V,Cantidad:0,Subcategoria:W,Codigo:o,Peso:""!==b?parseFloat(b):0,Precio:parseInt(a),Stock:!1,Descuento:0,Ubicacion:P,Pais:"Guinea Ecuatorial",Detalles:K,Imagen:n,Vistos:0,Vendedor:i,Compras:0,Fecha:l};let c={};c["GE/".concat(re,"/Prod/").concat(o)]=r,c["GE/Filtros/".concat(re,"/").concat(V,"/").concat(o)]=r,c["GE/Prod/".concat(i,"/").concat(o)]=r,await(0,m.yo)((0,m.KR)(ce),c);for(const e of X){const t=(0,m.VC)((0,m.KR)(ce,"GE/".concat(re,"/Prod/").concat(o,"/Color"))).key,a="GE/".concat(re,"/Prod/").concat(o,"/Color/").concat(t);await(0,m.hZ)((0,m.KR)(ce,a),{label:e,codigo:t})}for(const e in ee)if(ee.hasOwnProperty(e)){const t=(0,m.VC)((0,m.KR)(ce,"GE/".concat(re,"/Prod/").concat(o,"/Talla"))).key,n="GE/".concat(re,"/Prod/").concat(o,"/Talla/").concat(t);await(0,m.hZ)((0,m.KR)(ce,n),{label:e,precio:parseInt(""===ee[e]?a:ee[e]),codigo:t})}for(let e=0;e<U.length;e++)if(0===e){const e="GE/".concat(re,"/Prod/").concat(o,"/Imagenes/").concat(o);await(0,m.hZ)((0,m.KR)(ce,e),{Imagen:n,codigo:o})}else{const t=await ue(U[e]),a=(0,m.VC)((0,m.KR)(ce,"GE/".concat(re,"/Prod/").concat(o,"/Imagenes"))).key,n="GE/".concat(re,"/Prod/").concat(o,"/Imagenes/").concat(a);await(0,m.hZ)((0,m.KR)(ce,n),{Imagen:t,codigo:a})}t(""),A(""),G(""),N([]),L(null),q(null),z(null),te({}),$([]),E(""),C(""),k(""),R(""),_([]),ne(""),le(""),console.log("Publishing item:",r)}catch(o){alert("ERROR INESPERADO"),console.error("Transaction failed: ",o)}finally{D(!1)}}},sx:{padding:2,paddingTop:8},children:["Exterior"===re&&(0,f.jsx)("div",{style:{margin:10},children:[{label:"Aerea",value:"Aerea"},{label:"Maritima",value:"Maritima"}].map((e=>(0,f.jsx)(i.A,{label:e.label,style:{margin:3},clickable:!0,onClick:()=>{return t=e.label,console.log(t),void(t!==F&&L(t));var t},color:F===e.label?"primary":"default"},e.value)))}),J.length>0&&(0,f.jsx)(c.A,{children:"Categorias"}),(0,f.jsx)("div",{style:{margin:10},children:J.map((e=>(0,f.jsx)(i.A,{label:e.seccion,style:{margin:3},clickable:!0,onClick:()=>{var t;(t=e.seccion)!==V&&(z(null),q(t),me(t))},color:V===e.seccion?"primary":"default"},e.icono)))}),Q.length>0&&(0,f.jsx)(c.A,{children:"SubCategorias"}),(0,f.jsx)("div",{style:{margin:10},children:Q.map((e=>(0,f.jsx)(i.A,{label:e.seccion,style:{margin:3},clickable:!0,onClick:()=>{return t=e.seccion,void z(t);var t},color:W===e.seccion?"primary":"default"},e.icono)))}),(0,f.jsxs)(s.Ay,{container:!0,spacing:2,children:[(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Title",variant:"outlined",value:e,onChange:e=>t(e.target.value),required:!0,fullWidth:!0})}),(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Ubicacion",variant:"outlined",value:P,onChange:e=>R(e.target.value),required:!0,fullWidth:!0})}),(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Price",variant:"outlined",type:"number",value:a,onChange:e=>A(e.target.value),required:!0,fullWidth:!0})}),"Nacional"===re||"Aerea"===F?(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Introduzca los Kg",variant:"outlined",type:"number",value:b,onChange:e=>C(e.target.value),required:!0,fullWidth:!0})}):null,"Nacional"!==re&&(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Introduzca los Cm3",variant:"outlined",type:"number",value:w,onChange:e=>E(e.target.value),required:!0,fullWidth:!0})}),(0,f.jsx)(s.Ay,{item:!0,xs:12,children:(0,f.jsx)(u.A,{label:"Details",variant:"outlined",multiline:!0,rows:4,value:K,onChange:e=>G(e.target.value),required:!0,fullWidth:!0})}),(0,f.jsxs)("div",{style:{margin:10},children:[(0,f.jsx)(d.A,{value:ae,onChange:e=>ne(e.target.value),onKeyDown:e=>{"Enter"!==e.key&&","!==e.key||(e.preventDefault(),ae.trim()&&(_([...X,ae.trim()]),ne("")))},placeholder:"Introduzca Color"}),X.map(((e,t)=>(0,f.jsx)(i.A,{label:e,style:{margin:3},onDelete:()=>{return t=e,void _(X.filter((e=>e!==t)));var t}},t)))]}),(0,f.jsxs)("div",{style:{margin:10},children:[(0,f.jsx)(d.A,{value:oe,onChange:e=>le(e.target.value),onKeyDown:e=>{"Enter"!==e.key&&","!==e.key||(e.preventDefault(),oe.trim()&&($([...H,oe.trim()]),te({...ee,[oe.trim()]:""}),le("")))},placeholder:"Introduzca Estilo"}),H.map(((e,t)=>(0,f.jsxs)(o.A,{display:"flex",alignItems:"center",marginY:1,children:[(0,f.jsx)(i.A,{label:e,style:{margin:3},onDelete:()=>(e=>{console.log("wettin"),$(H.filter((t=>t!==e)));const t={...ee};delete t[e],te(t)})(e)}),(0,f.jsx)(u.A,{label:"Price",type:"number",value:ee[e]||"",onChange:t=>((e,t)=>{te({...ee,[t]:e.target.value})})(t,e),style:{marginLeft:"8px"}})]},t)))]}),(0,f.jsxs)(s.Ay,{item:!0,xs:12,children:[(0,f.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Images (up to 5)"}),(0,f.jsx)(d.A,{type:"file",multiple:!0,accept:"image/*",onChange:async e=>{const t=Array.from(e.target.files),a=await Promise.all(t.map((async e=>await de(e))));a.length+U.length<=5?N([...U,...a]):alert("You can upload up to 5 images only.")},required:!0,startAdornment:(0,f.jsx)(l.A,{color:"primary","aria-label":"upload pictures",component:"label",children:(0,f.jsx)(h.A,{})})}),(0,f.jsx)(o.A,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2},children:U.map(((e,t)=>(0,f.jsx)(j,{file:e,onRemove:()=>(e=>{N(U.filter(((t,a)=>a!==e)))})(t),index:t},t)))})]}),(0,f.jsx)(s.Ay,{item:!0,xs:12,display:"flex",justifyContent:"center",alignItems:"center",children:(0,f.jsx)(r.A,{type:"submit",variant:"contained",color:"primary",children:I?(0,f.jsx)(g.A,{color:"warning",size:24}):"PUBLICAR"})})]})]})]})}},1975:(e,t,a)=>{a.d(t,{D0:()=>o,o6:()=>n});a(563),a(6011),a(9950),a(2578),a(2241);const n=e=>{const t=e.match(/\d{5}$/);return t?t[0]:null};let o=(e,t)=>t.some((t=>t.Codigo===e))}}]);